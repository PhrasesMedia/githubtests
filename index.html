<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BabyPay – Maternity Calendar</title>
  <link rel="icon" href="icon.png" type="image/png" />

  <style>
    :root {
      --bg: #0b1020;
      --card: #0f1426;
      --muted: #97a0af;
      --text: #e7e9ed;
      --accent: #7aa2ff;
      --line: #1b2033;
      --good: #a7f3d0;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      font: 13px/1.4 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      min-height: 100%;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    @media (min-width: 900px) {
      body {
        align-items: center;
      }
    }

    .app {
      width: 100%;
      max-width: 720px;
      margin: 40px 20px;
    }

    @media (min-width: 900px) {
      .app {
        margin: 0 auto;
      }
    }

    header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    header img {
      width: 40px;
      height: 40px;
      border-radius: 8px;
    }

    header h1 {
      margin: 0;
      font-size: 20px;
    }

    header p {
      margin: 2px 0 0;
      color: var(--muted);
      font-size: 12px;
    }

    .card {
      background: var(--card);
      border-radius: 12px;
      padding: 16px 18px 18px;
      border: 1px solid var(--line);
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.45);
      margin-bottom: 16px;
    }

    .card h2 {
      margin: 0 0 12px;
      font-size: 15px;
    }

    .field {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: 10px;
    }

    .field span {
      font-size: 12px;
      margin-bottom: 4px;
    }

    .field small {
      font-size: 11px;
      color: var(--muted);
      margin-top: 3px;
    }

    .field input[type="date"],
    .field input[type="number"] {
      width: 100%;
      padding: 7px 9px;
      border-radius: 6px;
      border: 1px solid var(--line);
      background: #0b1020;
      color: var(--text);
      font-size: 13px;
      outline: none;
    }

    .field input[type="date"]:focus,
    .field input[type="number"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(122, 162, 255, 0.4);
    }

    .btn-primary {
      margin-top: 8px;
      padding: 9px 16px;
      border-radius: 8px;
      border: none;
      background: var(--accent);
      color: #0b1020;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-primary:hover {
      filter: brightness(1.05);
    }

    .btn-secondary {
      margin-top: 8px;
      padding: 8px 14px;
      border-radius: 8px;
      border: 1px solid var(--line);
      background: #10152a;
      color: var(--text);
      font-size: 12px;
      cursor: pointer;
    }

    .btn-secondary:hover {
      background: #141a31;
    }

    .hint {
      font-size: 11px;
      color: var(--muted);
      margin-top: 6px;
    }

    .result-note {
      font-size: 12px;
      color: var(--good);
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <!-- Optional logo, replace icon.png or remove img if you like -->
      <img src="icon.png" alt="BabyPay logo" onerror="this.style.display='none'" />
      <div>
        <h1>BabyPay</h1>
        <p>Maternity leave calendar helper</p>
      </div>
    </header>

    <section class="card">
      <h2>Maternity leave dates</h2>

      <!-- Leave start date -->
      <label class="field">
        <span>Leave start date</span>
        <input type="date" id="leaveStart" />
        <small>First day of parental leave for the primary carer.</small>
      </label>

      <!-- Gov PPL weeks (editable so it matches BabyPay if you want) -->
      <label class="field">
        <span>Government Paid Parental Leave (weeks)</span>
        <input type="number" id="govWeeks" min="0" step="1" value="24" />
        <small>Default 24 weeks. Adjust if BabyPay is using a different number.</small>
      </label>

      <!-- Work PPL weeks -->
      <label class="field">
        <span>Workplace paid parental leave (weeks)</span>
        <input type="number" id="workWeeks" min="0" step="1" value="28" />
        <small>For example: 28 weeks at half pay, or whatever your workplace offers.</small>
      </label>

      <!-- Download calendar button -->
      <button id="downloadCalendarBtn" type="button" class="btn-primary">
        Download maternity calendar (.ics)
      </button>

      <p class="hint">
        The downloaded file will create two all-day calendar events:
        one for Government PPL, and one for Workplace PPL, back-to-back.
      </p>

      <p id="calendarStatus" class="result-note" style="display:none;"></p>
    </section>

    <section class="card">
      <h2>BabyPay calculator (placeholder)</h2>
      <p class="hint">
        This demo page only shows the calendar feature.  
        On your real BabyPay site, you’d keep your full calculator here
        and just reuse the same date/weeks inputs to generate the calendar.
      </p>
    </section>
  </div>

  <script>
    // ======================================================
    // Maternity calendar (.ics) download for BabyPay
    // ======================================================

    const DEFAULT_GOV_WEEKS  = 24;
    const DEFAULT_WORK_WEEKS = 28;

    function getGovAndWorkWeeks() {
      const govWeeksInput  = document.getElementById('govWeeks');
      const workWeeksInput = document.getElementById('workWeeks');

      const govWeeks = govWeeksInput
        ? Number(govWeeksInput.value) || DEFAULT_GOV_WEEKS
        : DEFAULT_GOV_WEEKS;

      const workWeeks = workWeeksInput
        ? Number(workWeeksInput.value) || DEFAULT_WORK_WEEKS
        : DEFAULT_WORK_WEEKS;

      return { govWeeks, workWeeks };
    }

    function createICSCalendar(leaveStartDate, govWeeks, workWeeks) {
      function fmtDateTimeUTC(date) {
        return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
      }

      function fmtDateOnly(date) {
        return date.toISOString().slice(0, 10).replace(/-/g, '');
      }

      const now = fmtDateTimeUTC(new Date());

      const govStart = new Date(leaveStartDate.getTime());
      const govEnd   = new Date(govStart.getTime());
      // DTEND exclusive, so this covers govWeeks*7 days
      govEnd.setDate(govEnd.getDate() + govWeeks * 7);

      const workStart = new Date(govEnd.getTime());
      const workEnd   = new Date(workStart.getTime());
      workEnd.setDate(workEnd.getDate() + workWeeks * 7);

      const lines = [];

      lines.push(
        'BEGIN:VCALENDAR',
        'VERSION:2.0',
        'PRODID:-//BabyPay//Maternity Calendar//EN'
      );

      // Government PPL block
      lines.push(
        'BEGIN:VEVENT',
        'UID:babypay-gov-' + now,
        'DTSTAMP:' + now,
        'DTSTART;VALUE=DATE:' + fmtDateOnly(govStart),
        'DTEND;VALUE=DATE:' + fmtDateOnly(govEnd),
        'SUMMARY:Government Paid Parental Leave',
        'DESCRIPTION:Government Paid Parental Leave calculated via BabyPay.',
        'END:VEVENT'
      );

      // Workplace PPL block
      lines.push(
        'BEGIN:VEVENT',
        'UID:babypay-work-' + now,
        'DTSTAMP:' + now,
        'DTSTART;VALUE=DATE:' + fmtDateOnly(workStart),
        'DTEND;VALUE=DATE:' + fmtDateOnly(workEnd),
        'SUMMARY:Workplace Paid Parental Leave',
        'DESCRIPTION:Workplace Paid Parental Leave calculated via BabyPay.',
        'END:VEVENT'
      );

      lines.push('END:VCALENDAR');

      return lines.join('\r\n');
    }

    function downloadMaternityCalendar() {
      const statusEl = document.getElementById('calendarStatus');
      if (statusEl) {
        statusEl.style.display = 'none';
      }

      const leaveStartInput = document.getElementById('leaveStart');
      const leaveStartStr   = leaveStartInput ? leaveStartInput.value : '';

      if (!leaveStartStr) {
        alert('Please enter a leave start date first.');
        return;
      }

      const leaveStartDate = new Date(leaveStartStr + 'T00:00:00');
      if (isNaN(leaveStartDate.getTime())) {
        alert('That leave start date looks invalid. Please choose a valid date.');
        return;
      }

      const { govWeeks, workWeeks } = getGovAndWorkWeeks();

      const icsText = createICSCalendar(leaveStartDate, govWeeks, workWeeks);

      const blob = new Blob([icsText], {
        type: 'text/calendar;charset=utf-8'
      });
      const url  = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = 'babypay-maternity-calendar.ics';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      if (statusEl) {
        statusEl.textContent =
          'Calendar downloaded. Import it into Google Calendar, Apple Calendar or Outlook.';
        statusEl.style.display = 'block';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('downloadCalendarBtn');
      if (btn) {
        btn.addEventListener('click', downloadMaternityCalendar);
      }
    });
  </script>
</body>
</html>
